# PowerShell

## Obtener Software Instalado

```csharp
 Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* 
```

#### Conectar unidad compartida con Usuario y Contraseña

```csharp
$pass = "<password>" | ConvertTo-SecureString -asPlain -force
$cred = New-Object System.Management.automation.pscredential('username',$pass)
New-PsDrive -name <nombre de la unidad>  -root \\IP\Folder -Credential $cred -PsProvider "fileSystem"
```

#### Deshabilitar Windows Defender

```csharp
get-mppreference | select DisableRealtimeMonitoring
set-MpPreference -DisableRealtimeMonitoring $true
```

```csharp
$path ='HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\'


function disableav(){
New-ItemProperty $path -Name 'DisableAntiSpyware' -Value 0
}


$disabled = (Get-ItemProperty -Path $path -Name DisableAntiSpyware).DisableAntiSpyware

if ($disabled -eq $NULL){
    write-host "Not Exists"
    disableav
}
elseif ($disabled -eq 0) {
   write-host "Av is Disabled"
}
else {
   write-host "Disabling AV..." -foregroundcolor Green
   Set-ItemProperty -Path $path -Name DisableAntiSpyware -Value 0

}
```

#### Extracción de Logs&#x20;

```csharp
select EventoCode,TimeGenerated,InsertionStrings from Win32_NTLogEvent where LogFile='System' and (EventCode = '6009' Or EventCode = '1074')  # Logs de Prendido y Apagado del sistema
```
