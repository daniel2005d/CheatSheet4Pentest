# Enumeración

#### Versión de Windows

```powershell
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
```

#### Parches Instalados

```powershell
wmic qfe get Caption,Description,HotFixID,InstalledOnwer
```

#### Directorios con permisos

Estos son algunos de los posibles directorios de windows, donde cualquier usuario tiene permisos.

* c:\windows\system32\spool\drivers\color
* c:\windows\temp

#### Usuarios

```bash
net user # Enumera los usuarios locales
net user /domain # enumera los usuarios de dominio
net user <user> /domain # Propiedades de un usuario
```

#### Grupos

```bash
net localgroup # Listado de Grupos locales
net group # Lista los grupos globales del dominio.
net group /domain
whoami /groups # Listado de grupos a los que pertenece el usuario
net localgroup <grupo> <user> /ADD # Adicional el usuario a un grupo local
net group <grupo> <usuario> /ADD # Adicional el usuario a un grupo global de dominio
```

#### Buscar datos en el Regedit

```powershell
reg query HKLM /f <password> /t REG_SZ /s
reg query HKCU /f <password>power /t REG_SZ /s
```

#### Red

```csharp
netstat -an | find /i "listening"
netstat -ano | find /i "listening"
```

```csharp
sc.exe qc <Servicio> # Muestra información de un servicio
get-service <Servicio> # Muestra información de un servicio
```

* o: El id del proceso

|                                          |                                      |
| ---------------------------------------- | ------------------------------------ |
| net user \<user>                         | Muestra la configuración del usuario |
| whoami /priv                             | Ver los permisos del usuario         |
| net start                                | Ver todos los servicios arrancados   |
| systeminfo                               | Información completa del sistema     |
| \[System.Environment]::OSVersion.Version | Versión de Windows                   |
| net user \<username> \<password> /ADD    | Crea un nuevo usuario                |

#### Unidades de Disco

```csharp
 Get-PSDrive
 get-psdrive -PSProvider FileSystem
```

#### Autologin

```csharp
get-item "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"

# Base64
ZwBlAHQALQBpAHQAZQBtACAAIgBIAEsATABNADoAXABTAE8ARgBUAFcAQQBSAEUAXABNAGkAYwByAG8AcwBvAGYAdABcAFcAaQBuAGQAbwB3AHMAIABOAFQAXABDAHUAcgByAGUAbgB0AFYAZQByAHMAaQBvAG4AXABXAGkAbgBsAG8AZwBvAG4AIgAKAA==
```

#### Enumerar tareas Programadas

```
schtasks /query /fo LIST /v
```

#### Programas instalados

```powershell
wmic product get name,version,vendor
```

### Servicios

{% embed url="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/restart-service?view=powershell-7.2" %}

#### Obtener estado Windows Defender

```powershell
sc query windefend
get-wmiobject win32_service | ?{$_.Name -like "<servicio>" } | select * # Obtener toda la informacin del servicio
```

#### Estado de los servicios

```powershell
sc queryex type=service
wmic service list brief # Listado de los servicios
sc qc <Servicio> # Informacin detallada de un servicio en particular
```

#### Ejecutar con credenciales almacenadas

```
cmdkey /list #Obtiene el listado de credenciales almacenadas
runas /savecred /user:<usuario> ejecutable.exe #Ejecuta el comando con las credenciales almacenadas
```
